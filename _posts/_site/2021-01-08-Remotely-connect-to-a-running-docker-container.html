<p><img src="/assets/images/5wf8ffut3p3gz8nkpql6.jpeg" alt="Take control" /></p>

<p>A moment ago, when using Jenkins at <code class="language-plaintext highlighter-rouge">$work</code>, I discovered that I could connect <em>remotely</em> to a running docker container.</p>

<p>It is VERY handy ! Thanks to it you can deeply debug what’s wrong with a continuous integration run. There is even a “Pause” button (in Jenkins) that allows you to inspect a particular step or just avoid you the rush on fast runs.</p>

<p>And honestly, the first time I experimented, I found it a bit “magic” ! :grin:</p>

<p>Below is a detailed explanation on how to make the magic happens :smiley:</p>

<h2 id="expose-tcp-connection-on-dockerd-side">Expose tcp connection on dockerd side</h2>
<p>To be able to connect remotely, you have to start dockerd with the <code class="language-plaintext highlighter-rouge">-H tcp://0.0.0.0:2375</code> option to expose the tcp socket.</p>

<p>Edit your docker systemd service to add a tcp socket :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dockerd <span class="nt">-H</span> fd:// <span class="nt">-H</span> tcp://0.0.0.0:2375 <span class="nt">--containerd</span><span class="o">=</span>/run/containerd/containerd.sock
</code></pre></div></div>

<p>Reload service config:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl daemon-reload
</code></pre></div></div>

<p>And restart <code class="language-plaintext highlighter-rouge">dockerd</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl restart docker
</code></pre></div></div>

<h2 id="run-a-sample-container">Run a sample container</h2>
<p>I will take a small <code class="language-plaintext highlighter-rouge">alpine</code> and just run a “never ending script” inside:</p>

<p>Write a Dockerfile:</p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> alpine</span>

<span class="k">COPY</span><span class="s"> w.sh w.sh</span>
<span class="k">CMD</span><span class="s"> ["./w.sh"]</span>
</code></pre></div></div>

<p>And a while/sleep loop <code class="language-plaintext highlighter-rouge">w.sh</code> to maintain it alive:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span><span class="nb">sleep </span>2 <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"alive"</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<p>Build the image:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nb">.</span> <span class="nt">-t</span> persist
</code></pre></div></div>

<p>And finally, start the container:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-itd</span> persist
f70b46b77105700d3420b88323d07edff9146f435a13c73029efd92197ef9030
</code></pre></div></div>

<h2 id="connect-from-client">Connect from client</h2>
<p>Now on your laptop (for instance) you can now connect to your docker container simply like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker <span class="nt">-H</span> tcp://the-url-or-ip <span class="nb">exec</span> <span class="nt">-ti</span> f70b46b77105700d3420b88323d07edff9146f435a13c73029efd92197ef9030 /bin/sh
</code></pre></div></div>

<p>And you get your shell:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ <span class="c">#</span>
</code></pre></div></div>

<p>Tadaaa !</p>

<p><img src="/assets/images/yhce6495warb8aj8zf9b.jpeg" alt="Tadaaa" /></p>
