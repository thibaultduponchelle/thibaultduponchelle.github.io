<p>This is the first post of a serie about <a href="https://en.wikipedia.org/wiki/Just_another_Perl_hacker">Japhs</a></p>

<p>Japhs are crazy-cursed-science, people sometimes love them as much as they hate them :smiley:</p>

<p><img src="/assets/images/nzklo0g6g51s1b93a34p.jpg" alt="Crazy Japh" /></p>

<p>Japhs could be a showcase of obfuscated, bad practices, non modern Perl code but it is also often a demonstration of Perl skills and a way to nicely highlight some features or simply demonstrate code agility.</p>

<p>Several Japhs were written by “Perl Grand Masters”.</p>

<h2 id="do-not-do">DO-NOT-DO</h2>
<p>Often a Japh is more a matter of <strong>obfuscation</strong> than <strong>encryption</strong>.</p>

<p>This is the case of this <strong>Japh</strong> from <strong>Randal Schwartz</strong>, where a simple <code class="language-plaintext highlighter-rouge">print"Just another Perl hacker,"</code> is surrounded by “garbage code”.</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$_</span><span class="o">=</span><span class="p">'</span><span class="s1">987;s/^(d+)/$1-1/e;$1?eval:print"Just another Perl hacker,"</span><span class="p">';</span><span class="nb">eval</span><span class="p">;</span>
</code></pre></div></div>

<p>This Japh is actually full of nothing :smiley:</p>

<p>Once unfold, the code is actually very simple but there is some interesting bits here :</p>
<ul>
  <li>Some fun with <code class="language-plaintext highlighter-rouge">/e</code> modifier (= evaluate right hand side <code class="language-plaintext highlighter-rouge">RHS</code>)</li>
  <li>A misleading <code class="language-plaintext highlighter-rouge">(d+)</code> capture (vicious typo : missing <code class="language-plaintext highlighter-rouge">\</code> ! :smile:) that leads to a <code class="language-plaintext highlighter-rouge">$1</code> actually undefined</li>
  <li>Some fun with eval (the Japh <em>killer-feature</em> :smiley:)</li>
</ul>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">eval</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$v</span> <span class="o">=</span> <span class="p">"</span><span class="s2">987</span><span class="p">";</span> <span class="c1"># or my $v = 987; it is the same</span>
        <span class="c1"># Substitute number by himself minus one</span>
        <span class="nv">$v</span> <span class="o">=~</span> <span class="sr">s/^(d+)/$1-1/</span><span class="nv">e</span><span class="p">;</span> <span class="c1"># /e enable right hand side as an expression</span>
        <span class="c1"># $v is (still) "987";</span>
        <span class="c1"># $1 is undefined </span>
        <span class="c1"># because to work</span>
        <span class="c1"># capture (d+) should be (\d+)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">undef</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">eval</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">print</span><span class="p">"</span><span class="s2">Just another Perl hacker,</span><span class="p">";</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I really love this Japh !!</p>

<h2 id="jump-jump">Jump-Jump</h2>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$_</span><span class="o">=</span><span class="p">"</span><span class="s2">krJhruaesrltre c a cnP,ohet</span><span class="p">";</span><span class="vg">$_</span><span class="o">.=</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="k">print</span><span class="err">$</span><span class="mi">2</span><span class="k">while</span> <span class="sr">s/(..)(.)//</span><span class="p">;</span>
</code></pre></div></div>

<p>The trick here is to loop over a string and take one char every 3 chars (but only one time per loop).</p>

<p>Having all keywords sticked together like this :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$_</span><span class="o">.=</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="k">print</span><span class="err">$</span><span class="mi">2</span><span class="k">while</span>
</code></pre></div></div>
<p>is a way to exploit the greatness of the parser ! :sunglasses:</p>

<p>When I first saw this Japh, I was not sure to understand well <code class="language-plaintext highlighter-rouge">s/(..)(.)//</code> 
because it seemed the string matched was substitued by nothing.</p>

<p>But is is actually kept by <code class="language-plaintext highlighter-rouge">$_.=$1</code>.</p>

<p>It is the same than this code :</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span><span class="p">"</span><span class="s2">krJhruaesrltre c a cnP,ohet</span><span class="p">";</span>

<span class="k">do</span> <span class="p">{</span> 
	<span class="nv">$str</span> <span class="o">.=</span> <span class="err">$</span><span class="mi">1</span><span class="p">;</span> <span class="c1"># Keep 2 char (..)</span>
	<span class="k">print</span> <span class="err">$</span><span class="mi">2</span><span class="p">;</span> <span class="c1"># Print one char (.)</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$str</span> <span class="o">=~</span> <span class="sr">s/(..)(.)//</span><span class="p">);</span>
</code></pre></div></div>

<p>What if we print the <code class="language-plaintext highlighter-rouge">$str</code> to see the content ?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>krJhruaesrltre c a cnP,ohet
hruaesrltre c a cnP,ohetkr
aesrltre c a cnP,ohetkrhr
rltre c a cnP,ohetkrhrae
re c a cnP,ohetkrhraerl
c a cnP,ohetkrhraerlre
 cnP,ohetkrhraerlrec 
P,ohetkrhraerlrec  c
hetkrhraerlrec  cP,
krhraerlrec  cP,he
raerlrec  cP,hekr
rlrec  cP,hekrra
ec  cP,hekrrarl
 cP,hekrrarlec
,hekrrarlec c
krrarlec c,h
arlec c,hkr
ec c,hkrar
c,hkrarec
krarecc,
recc,kr
c,krre
rrec,
c,rr
rc,
rc
</code></pre></div></div>

<p>And if you look closer, you can see the <code class="language-plaintext highlighter-rouge">Just another Perl hacker,</code> hidden like a sort of <a href="https://en.wikipedia.org/wiki/Steganography">steganography</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kr[J]hruaesrltre c a cnP,ohet
hr[u]aesrltre c a cnP,ohetkr
ae[s]rltre c a cnP,ohetkrhr
rl[t]re c a cnP,ohetkrhrae
re[ ]c a cnP,ohetkrhraerl
c [a] cnP,ohetkrhraerlre
 c[n]P,ohetkrhraerlrec 
P,[o]hetkrhraerlrec  c
he[t]krhraerlrec  cP,
kr[h]raerlrec  cP,he
ra[e]rlrec  cP,hekr
rl[r]ec  cP,hekrra
ec[ ] cP,hekrrarl
 c[P],hekrrarlec
,h[e]krrarlec c
kr[r]arlec c,h
ar[l]ec c,hkr
ec[ ]c,hkrar
c,[h]krarec
kr[a]recc,
re[c]c,kr
c,[k]rre
rr[e]c,
c,[r]r
rc[,]
rc
</code></pre></div></div>

<p>The “substitution per nothing” and the “only one time per loop” tricks are confusing for me.</p>

<p>In my mind, I would have prefered something like this :</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span><span class="p">"</span><span class="s2">krJhruaesrltre c a cnP,ohet</span><span class="p">";</span>

<span class="k">do</span> <span class="p">{</span>
        <span class="k">print</span> <span class="err">$</span><span class="mi">2</span><span class="p">;</span> <span class="c1"># Print one char</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$str</span> <span class="o">=~</span> <span class="sr">s/(..)(.)(.*)/$3$1/</span><span class="p">);</span>
</code></pre></div></div>

<p>But one of the goal of a Japh is to confuse the reader, isn’t it ?</p>

<p>And this goal is well achieved by this really nice Japh !</p>

<h2 id="eval-ception">Eval-ception</h2>

<p>This Japh from <strong>Raymond Chen</strong> is playing with <code class="language-plaintext highlighter-rouge">eval</code> and <code class="language-plaintext highlighter-rouge">\</code> (protected quotes by antislash).</p>

<p>All the annoying <code class="language-plaintext highlighter-rouge">\</code>, <code class="language-plaintext highlighter-rouge">"</code> and <code class="language-plaintext highlighter-rouge">x</code> makes this line very <em>blurry</em> to the reader.</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$_</span><span class="o">=</span><span class="p">'</span><span class="s1">x"Not ";"x\"another \";</span><span class="se">\'</span><span class="s1">x</span><span class="se">\\</span><span class="s1">"perl </span><span class="se">\\</span><span class="s1">";x</span><span class="se">\\</span><span class="s1">"hacker,</span><span class="se">\\</span><span class="s1">"</span><span class="se">\'</span><span class="s1">"</span><span class="p">';</span><span class="sr">s/x/print/g</span><span class="p">;</span><span class="nb">eval</span> <span class="nb">eval</span> <span class="nb">eval</span><span class="p">;</span>
</code></pre></div></div>

<p>It is actually relatively simple when we break down into steps to see what happens exactly :</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nv">v5</span><span class="mf">.10</span><span class="p">;</span>

<span class="nv">$str</span> <span class="o">=</span> <span class="p">'</span><span class="s1">x"Not ";"x\"another \";</span><span class="se">\'</span><span class="s1">x</span><span class="se">\\</span><span class="s1">"perl </span><span class="se">\\</span><span class="s1">";x</span><span class="se">\\</span><span class="s1">"hacker,</span><span class="se">\\</span><span class="s1">"</span><span class="se">\'</span><span class="s1">"</span><span class="p">';</span>
<span class="nv">$str</span> <span class="o">=~</span> <span class="sr">s/x/print/g</span><span class="p">;</span>
<span class="c1"># 'print"Not "; "print\"another \";\'print\\"perl \\";print\\"hacker,\\"\'"';</span>
<span class="nv">say</span> <span class="nb">eval</span> <span class="nv">$str</span><span class="p">;</span>
<span class="c1"># Not print"another ";'print"perl ";print"hacker,"'</span>
<span class="nv">say</span> <span class="nb">eval</span> <span class="nb">eval</span> <span class="nv">$str</span><span class="p">;</span>
<span class="c1"># Not another print"perl ";print"hacker,"</span>
<span class="nb">eval</span> <span class="nb">eval</span> <span class="nb">eval</span> <span class="nv">$str</span><span class="p">;</span>
<span class="c1"># Not another perl hacker,</span>
</code></pre></div></div>

<p>First eval will print <code class="language-plaintext highlighter-rouge">Not</code> and remove <code class="language-plaintext highlighter-rouge">"</code> around the rest of the line :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">"</span><span class="s2">Not </span><span class="p">";"</span><span class="s2">print</span><span class="se">\"</span><span class="s2">another </span><span class="se">\"</span><span class="s2">;'print</span><span class="se">\"</span><span class="s2">perl </span><span class="se">\"</span><span class="s2">;print</span><span class="se">\"</span><span class="s2">hacker,</span><span class="se">\"</span><span class="s2">'</span><span class="p">"</span>
            <span class="o">^</span>                                                   <span class="o">^</span>
</code></pre></div></div>

<p>Second eval will print <code class="language-plaintext highlighter-rouge">another</code> and remove <code class="language-plaintext highlighter-rouge">'</code> around the rest of the line :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Not</span> <span class="k">print</span><span class="p">"</span><span class="s2">another </span><span class="p">";'</span><span class="s1">print"perl ";print"hacker,"</span><span class="p">'</span>
                    <span class="o">^</span>                           <span class="o">^</span>
</code></pre></div></div>

<p>Third eval will print <code class="language-plaintext highlighter-rouge">perl hacker,</code> :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Not</span> <span class="nv">another</span> <span class="k">print</span><span class="p">"</span><span class="s2">perl </span><span class="p">";</span><span class="k">print</span><span class="p">"</span><span class="s2">hacker,</span><span class="p">"</span>
</code></pre></div></div>

<p>And finally this is <code class="language-plaintext highlighter-rouge">Not another perl hacker</code> ! :smiley:</p>

<h2 id="the-char-taker">The Char-taker</h2>

<p>This is a Japh from <a href="https://github.com/gnebbia/japh">gnebbia</a></p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">Modern::</span><span class="nv">Perl</span><span class="p">;</span>

<span class="nv">say</span> <span class="nb">chr</span><span class="p">(</span><span class="vg">$_</span><span class="p">)</span> <span class="k">foreach</span> <span class="sx">qw/ 
74	117 
115		116 
20 			97 
110				111
116				104
101				114
20			80
101		114
108	20
72
97
99
107
101
114/</span><span class="p">;</span>
</code></pre></div></div>

<p>Simple and effective !</p>

<p>Not very hard to understand, but it uses some nice features from perl.</p>

<p>The <code class="language-plaintext highlighter-rouge">qw</code> actually drops some formatting for us and builds a clean <code class="language-plaintext highlighter-rouge">array of string</code>.</p>

<p>Then the indentation and spaces are ignored and <code class="language-plaintext highlighter-rouge">chr</code> will tranform ASCII codes into a Japh :smiley:</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">Modern::</span><span class="nv">Perl</span><span class="p">;</span>

<span class="c1">#              J   u   s   t      a  n   o   t   h   e   r      P  e   r   l      h  a  c  k   e   r</span>
<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$d</span> <span class="p">(</span><span class="mi">74</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">114</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">print</span> <span class="nb">chr</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This Japh does not really confuse the reader, but force to dig a bit into language understanding, and that’s very cool ! :sunglasses:</p>

<h2 id="split-sort-grep">Split-Sort-Grep</h2>
<p><strong>Randal Schwartz</strong>, in addition of being <strong>Japh #0</strong> is one of the master of the Japh competition.</p>

<p>He plays often a lot with <code class="language-plaintext highlighter-rouge">split</code> combined with some other operands, here it is <code class="language-plaintext highlighter-rouge">grep</code> and <code class="language-plaintext highlighter-rouge">sort</code>.</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="nb">grep</span><span class="p">(</span><span class="sr">s/^\d+(.*)/$1 /</span><span class="p">,</span> <span class="nb">sort</span><span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="sr">/ /</span><span class="p">,"</span><span class="s2">8hacker, 4Perl 1Just 2another</span><span class="p">")));</span>
</code></pre></div></div>

<p>I feel comfortable with this one, I see the Japh unordered but there is a <code class="language-plaintext highlighter-rouge">sort</code> not far and numbers will give the ordering :grin:</p>

<p>It is a way to properly demonstrate some Perl killer features like <strong>easy string manipulation</strong> and <strong>regular expressions</strong>.</p>

<p>We can detail this one liner into an equivalent script :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">"</span><span class="s2">8hacker, 4Perl 1Just 2another</span><span class="p">";</span>
<span class="k">my</span> <span class="nv">@s</span> <span class="o">=</span> <span class="nb">split</span> <span class="p">"</span><span class="s2"> </span><span class="p">",</span> <span class="nv">$str</span><span class="p">;</span>
<span class="nv">@s</span> <span class="o">=</span> <span class="nb">sort</span> <span class="nv">@s</span><span class="p">;</span>
<span class="c1"># 1Just 2another 4Perl 8hacker,</span>
<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$v</span> <span class="p">(</span><span class="nv">@s</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$v</span> <span class="o">=~</span> <span class="sr">s/^\d(.*)/$1/</span><span class="p">;</span>
        <span class="k">print</span> <span class="nv">$v</span> <span class="o">.</span> <span class="p">"</span><span class="s2"> </span><span class="p">";</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$1</code> is what is matched between parenthesis.</p>

<p><code class="language-plaintext highlighter-rouge">sort</code> will not convert to numeric but compare string, if you’re not convinced, please check this example :</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">"</span><span class="s2">09first 2third 1second</span><span class="p">";</span> 
<span class="k">print</span> <span class="nb">join</span> <span class="p">"</span><span class="s2"> </span><span class="p">",</span> <span class="nb">sort</span> <span class="nb">split</span><span class="p">("</span><span class="s2"> </span><span class="p">",</span> <span class="nv">$str</span><span class="p">);</span>
</code></pre></div></div>

<p>That produces :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>09first 1second 2third
</code></pre></div></div>

<p>Despite being relatively simple, this is a cool Japh, demonstrating some nice Perl features. :smiley:</p>

<h2 id="turtle-neck">Turtle Neck</h2>
<p>OH! Turtleneck phrase jar! :astonished:</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$_</span> <span class="o">=</span> <span class="p">"</span><span class="s2">wftedskaebjgdpjgidbsmnjgc</span><span class="p">";</span>
 <span class="sr">tr/a-z/oh, turtleneck Phrase Jar!/</span><span class="p">;</span> <span class="k">print</span><span class="p">;</span>
</code></pre></div></div>

<p>This Japh is playing with <strong>transliteration operator</strong>, the <strong>regex range</strong> and the <strong>default variable</strong> <code class="language-plaintext highlighter-rouge">$_</code> features.</p>

<p>The <code class="language-plaintext highlighter-rouge">tr</code> is an operator to <strong>translate</strong> (like the Unix <code class="language-plaintext highlighter-rouge">tr</code> command line).</p>

<p><code class="language-plaintext highlighter-rouge">a-z</code> in the regex is actually implicitely transformed into <code class="language-plaintext highlighter-rouge">abcdefghijklmnopqrstuvwxyz</code>.</p>

<p>Then we only have to pick our Japh using the <em>“key”</em> <code class="language-plaintext highlighter-rouge">wftedskaebjgdpjgidbsmnjgc</code> ! :sunglasses:</p>

<p>Once unfold, the Japh looks like this :</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">"</span><span class="s2">wftedskaebjgdpjgidbsmnjgc</span><span class="p">";</span>
<span class="nv">$str</span> <span class="o">=~</span> <span class="sr">tr/abcdefghijklmnopqrstuvwxyz/oh, turtleneck Phrase Jar!/</span><span class="p">;</span>
<span class="k">print</span> <span class="nv">$str</span><span class="p">;</span>
</code></pre></div></div>

<p>Relatively simple, but a very cool Japh !</p>

<h2 id="conclusion">Conclusion</h2>
<p>This is the end of my first post about Japhs !</p>

<p><img src="/assets/images/ox3qqsnwu89ctcuzw6jk.jpg" alt="Crazy Japh" /></p>

<p>I hope you enjoyed as much as me :grin:</p>

<p>Check the <a href="https://dev.to/thibaultduponchelle/japhs-autopsies-2-41jl">next post of the serie</a></p>
